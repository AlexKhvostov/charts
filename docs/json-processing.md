## Обработка JSON для сборки и отображения чарта

- **Источник данных**
  - Файлы `*.json` в каталоге `json_3408/*.json` (30 файлов).
  - Единственная страница: корневой `index.html` (галерея). Она подключает модульные файлы из `js/` и читает данные из `json_3408/manifest.json`.
  - PHP API и каталоги `pack_3408/*` больше не используются.

- **Ключевые правила**
  - Для анализа (поиска ближайших уровней) используем ТОЛЬКО графы, где `secondAction === null`.
  - Базовый уровень — около 15 BB. Если на нём нет валидных графов, берём ближайший валидный (сначала выше, затем ниже).
  - Подсказки-уголки сейчас считаем только для уровней НИЖЕ базового (верх отключён в коде). Изменение фиксируем, только если изменился состав действий ячейки (учитываем сплиты).

- **Структура данных в JSON**
  - `chart.stackRanges[]`: диапазоны стеков, у каждого `charts[]` (один или несколько графов).
  - `charts[].combinations`: строка с записями вида `#index,isRandom,actionsSpec`, где `actionsSpec` может быть сплитом, например `c(50)-a`.
  - `answers`: справочник действий и цветов (`f`, `c`, `a`, `r`).

- **Парсинг комбинаций** (`js/utils/chartAnalyzer.js`)
  - `parseCombinations(combinationsString)`:
    - Разбирает каждую ячейку.
    - `value` — первое действие в сплите.
    - `actions` — полный список действий ячейки (например, `['c','a']`).
  - Вспомогательные:
    - `getCellAction(...)` — основное действие.
    - `getCellActionsSet(...)` — множество всех действий ячейки.
    - `gatherActionsFromAllCharts(...)` — множество действий ячейки, собранное по всем валидным графам диапазона.

- **Выбор базового диапазона** (`findDefaultRange` + донастройка)
  - Ищем диапазон с `rangeMin >= 15`. Если нет — ближайший под 15.
  - Если в базовом диапазоне нет валидных графов (`secondAction===null`), выбираем ближайший валидный диапазон (сначала выше, затем ниже).

- **Формирование баз и анализ** (`analyzeMatrix` → `analyzeCellDifferences`)
  - На каждый диапазон готовим:
    - `byRangeFirst[rangeId]` — комбинации первого валидного графа (для «основного цвета» текущего уровня).
    - `byRangeAll[rangeId]` — массив комбинаций всех валидных графов (для поиска изменений на соседних уровнях).
  - Для каждой из 169 ячеек:
    - Базовый набор действий: `baseSet` на эффективном базовом уровне.
    - Идём по уровням ниже (меньше 15):
      - Собираем `actionsSet` (с учётом сплитов и всех валидных графов уровня).
      - Если `actionsSet` и `baseSet` совпадают полностью — изменений нет.
      - Если отличаются — фиксируем подсказку для действия, которого не было в `baseSet`:
        - `fold` → `fold = rangeMax`.
        - `call` → `call = rangeMax`.
        - Дополнительно (т.к. верх отключён): `allin`/`raise` → `allin|raise = rangeMax`.
    - Верхние уровни (больше 15) для `raise/all-in` сейчас закомментированы.

- **Сбор текущего чарта для отрисовки (галерея)**
  - Страница `index.html` загружает список из `json_3408/manifest.json`, по каждому файлу загружает JSON.
  - Запускается `analyzeMatrix(chartData.chart)` (анализ учитывает только `secondAction===null` и только уровни ниже).
  - Для отображения берём первый граф диапазона по умолчанию (`range.charts[0]`) и формируем `currentChart = { ...chart, analysis, answers }`.
  - `answers` берём из графа или из корня `chart.answers`, иначе используем дефолтный набор цветов.

- **Отрисовка матрицы** (`js/components/ChartMatrix.js`)
  - Заголовок внутри компонента: `div.matrix-title` (компактная полоса по ширине матрицы).
  - Сетка 13×13: `div.matrix`.
  - Ячейка (`ChartCell`):
    - Основной фон — по первичному действию; при сплите двух действий — градиент 50/50.
    - Уголки — `raise/allin/fold/call` по рассчитанным ближайшим уровням.

- **Пути к ключевым файлам**
  - Страница галереи: `index.html`.
  - Аналитика: `js/utils/chartAnalyzer.js`.
  - Компонент матрицы: `js/components/ChartMatrix.js`.
  - Данные: `json_3408/manifest.json`, `json_3408/*.json`.

- **Быстрый чек-лист при возвращении к задаче**
  - Помни: считаем только графы с `secondAction === null`.
  - База — около 15 BB; если нет валидных — ближайший валидный.
  - Верх отключён: анализируем только уровни ниже базового.
  - Сплиты сравниваем как множества действий. Подсказку ставим только при изменении состава.
  - При отсутствии `answers` — используем дефолтный набор цветов/действий.

- **Как запустить**
  - Открой `index.html` под статическим сервером (например, через встроенный сервер PHP или любой http‑server). Страница читает данные из `json_3408` и рендерит 30 чартов (по 4 в ряд на широких экранах).


